(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();let p,h,u,b,d,a;document.addEventListener("DOMContentLoaded",async()=>{v(document),a=await E(),c(a),w()});const E=async()=>{try{return await(await fetch("/liste_produits_quotidien.json")).json()}catch(e){return console.error("Error fetching products:",e),[]}};function v(e){p=e.getElementById("liste-produits"),h=e.getElementById("compteur-produits"),u=e.getElementById("tri"),b=e.getElementById("reset-filtres"),d=e.getElementById("recherche")}function c(e){p.innerHTML="",e.forEach(t=>{q(t)}),h.textContent=`${e.length} produits`}function w(){b.addEventListener("click",()=>{u.value="",d.value="",c(a)}),u.addEventListener("change",e=>{const t=e.target.value,r=x(a,t);c(r)}),d.addEventListener("input",e=>{const t=e.target.value.toLowerCase(),r=C(a,t);c(r)})}function x(e,t){return t==="prix"?e.sort((r,s)=>r.prix_unitaire-s.prix_unitaire):t==="nom"?e.sort((r,s)=>r.nom.localeCompare(s.nom)):e}function C(e,t){return e.filter(r=>r.nom.toLowerCase().includes(t.toLowerCase()))}function k(e){const t=window.localStorage,r=JSON.parse(t.getItem("basket"))||[],s=r.find(o=>o.nom===e.nom);return s?s.quantity+=1:r.push({nom:e.nom,price:e.prix_unitaire,quantity:1}),t.setItem("basket",JSON.stringify(r)),r}function q(e){const t=document.createElement("li");t.classList.add("bg-white","p-2","flex","flex-col","gap-2","border","border-gray-300","rounded-lg","w-full","md:w-1/5","h-52","justify-between");const r=document.createElement("h2");r.classList.add("text-lg","font-bold","text-center");const s=document.createElement("span"),o=document.createElement("span"),n=document.createElement("button");n.addEventListener("click",()=>{const y=k(e).find(L=>L.nom===e.nom);let g=e.quantite_stock-y.quantity;s.innerHTML=`<span class="font-bold">Quantité en stock</span>: ${g}`,g<=0&&(n.disabled=!0,n.classList.remove("bg-blue-500","hover:bg-blue-700"),n.classList.add("bg-gray-500"),t.classList.add("opacity-50"))}),n.textContent="Ajouter au panier",n.classList.add("bg-blue-500","text-white","p-2","rounded-lg","hover:bg-blue-700","transition-colors","duration-300","hover:cursor-pointer"),n.dataset.id=e.nom,r.innerHTML=`<span class="font-bold">${e.nom}</span>`;const i=JSON.parse(localStorage.getItem("basket"))||[];let l=e.quantite_stock;const f=i.find(m=>m.nom===e.nom);l-=f?f.quantity:0,l<=0&&(n.disabled=!0,n.classList.remove("bg-blue-500","hover:bg-blue-700","hover:cursor-pointer"),n.classList.add("bg-gray-500"),t.classList.add("opacity-50")),s.innerHTML=`<span class="font-bold">Quantité en stock</span>: ${l}`,o.innerHTML=`<span class="font-bold">Prix unitaire</span>: ${e.prix_unitaire} €`,t.appendChild(r),t.appendChild(s),t.appendChild(o),t.appendChild(n),p.appendChild(t)}document.getElementById("copyright-date").textContent=new Date().getFullYear();
